
operator Chi : BS_r -> Matrix_{m+1,1}.
adversary A_lwe : (Matrix_{n,m+1} * Matrix_{m+1,1}) -> Bool.
assumption LWE
 [ A <-$ Matrix_{n,m+1}; s <-$ Matrix_{n,1}; r <-$ BS_r;  b <- A_lwe(A, (tr A) * s + Chi(r));]
 [ A <-$ Matrix_{n,m+1}; u <-$ Matrix_{m+1,1}; b <- A_lwe(A, u);].

 operator bit_inj : BS_m -> Matrix_{m,1}.
 adversary A_lhl : (Matrix_{n,m} * Matrix_{n,1}) -> Bool.
 assumption LHL
 [ A <-$ Matrix_{n,m}; e <-$ BS_m; b <- A_lhl(A, A * bit_inj(e));]
 [ A <-$ Matrix_{n,m}; u <-$ Matrix_{n,1}; b <- A_lhl(A, u);].

adversary A_pke : (Matrix_{n,m} * Matrix_{m,1} * Matrix_{n,1} * Matrix_{1,1}) -> Bool.

operator Mu : () -> Matrix_{1,1}.

bound_adv [
  let mu = Mu(());
    b <-$ Bool; let m = b?Mu(()):0_{1,1};
    re <-$ BS_m;
  let e = bit_inj(re);
  
   A <-$ Matrix_{n,m};
  let u = A * e;
    s <-$ Matrix_{n,1};
  
     r <-$ BS_r;
   let X_ = tr Chi(r);
   let X = tr (sl X_);
   let x = tr (sr X_);

   let c1 = (tr A) * s + X;
   let c2 = (tr u) * s + x + m;
   b' <- A_pke (A,c1,u,c2);
 ] : b=b'.
norm.
move 3 1.
move 3 2.
assumption_decisional! LHL -> u.
norm.

bound_adv [
  Au <-$ Matrix_{n,m+1};
  let A = sl Au;
  let u = sr Au;
    b <-$ Bool;
  let m = b?Mu(()):0_{1,1};
  s <-$ Matrix_{n,1};
    r <-$ BS_r;
  let c = (tr Au) * s + Chi(r);
 
  b' <- A_pke(sl Au, tr sl tr c, sr Au, (tr sr tr c) + m);
] : b = b'.
move 6 2.
move 7 3.
norm.
assumption_decisional! LWE -> w.
norm.
rnd w (w -> tr w) (w -> tr w).
norm.
  indep!.
qed.